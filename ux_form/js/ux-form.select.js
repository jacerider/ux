"use strict";!function(s,r,e,t){var i="uxFormSelect";function n(e,t){this.element=e,this.$element=s(this.element),this._name=i,this._defaults=s.fn.uxFormSelect.defaults,this.options=s.extend({},this._defaults,t),this.uniqueId=r.Ux.guid(),this.init()}s.extend(n.prototype,{init:function(){this.buildCache(),this.buildElement(),this.evaluateElement(),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildCache:function(){this.$field=this.$element.find("select"),this.$error=this.$element.find(".field-error"),this.$trigger=s('<input class="ux-form-input-item ux-form-input-item-js" '+(this.isDisabled()?"disabled":"")+' readonly tabindex="-1"></input>'),this.$wrapper=s('<div class="ux-form-select-wrapper ux-form-input ux-form-input-js"></div>'),this.$caret=s('<span class="ux-form-select-caret">&#9660;</span>'),this.multiple=!!this.$field.attr("multiple"),this.placeholder=this.$field.attr("placeholder")||(this.multiple?"Select Multiple":"Select One"),this.$trigger.addClass("ux-form-select-trigger"),this.$trigger.attr("placeholder",this.placeholder),this.isSupported=this.isSupported(),this.$error.length,this.isSupported?(this.$hidden=s('<input class="ux-form-select-hidden"></input>'),this.$field.attr("tabindex")&&this.$hidden.attr("tabindex",this.$field.attr("tabindex")),this.$field.attr("tabindex","-1"),this.$dropdown=s('<div class="ux-form-select-dropdown"></div>'),this.$dropdownScroll=s('<ul class="ux-form-select-scroll"></div>').appendTo(this.$dropdown),this.$wrapper.append(this.$caret).append(this.$hidden).append(this.$trigger).append(this.$dropdown),this.$dropdown.addClass(this.multiple?"is-multiple":"is-single")):this.$wrapper.append(this.$caret).append(this.$trigger);var e=s("<div></div>");this.$wrapper.appendTo(e),r.attachBehaviors(e[0]),this.$wrapper=e.contents(),this.$wrapper.insertAfter(this.$field),this.$wrapper.append(this.$field)},buildElement:function(){var e=this;e.loadOptionsFromSelect(),e.updateTrigger(),e.options.debug&&(e.$field.show(),setTimeout(function(){e.$trigger.trigger("tap")},500)),setTimeout(function(){e.$element.addClass("ready")})},evaluateElement:function(){var e=this;e.isRequired()&&(e.$field.removeAttr("required"),e.$trigger.attr("required","required"))},bindEvents:function(){var t=this;t.$trigger.on("focus."+t._name,function(e){s(this).blur()}).on("tap."+t._name,function(e){t.isSupported?(t.populateDropdown.call(t),t.showDropdown.call(t)):(e.preventDefault(),t.$field.show().focus().hide())}),t.$field.on("state:disabled."+t._name,function(e){t.evaluateElement()}).on("state:required."+t._name,function(e){t.evaluateElement()}).on("state:visible."+t._name,function(e){t.evaluateElement()}).on("state:collapsed."+t._name,function(e){t.evaluateElement()}),t.isSupported?(t.$dropdown.on("tap."+t._name,".selector",function(e){t.onItemTap.call(t,e)}),t.$dropdown.on("tap."+t._name,".close",function(e){t.closeDropdown.call(t)}),t.$hidden.on("focusin."+t._name,function(e){t.$wrapper.addClass("focus"),e.relatedTarget&&!t.$dropdown.find(e.relatedTarget).length&&(t.populateDropdown.call(t),t.showDropdown.call(t))}).on("blur."+t._name,function(e){t.$wrapper.removeClass("focus")}).on("keydown."+t._name,function(e){t.onHiddenKeydown.call(t,e)}),t.$field.on("change."+t._name,function(e){t.loadOptionsFromSelect(),t.updateTrigger()}),t.$field.attr("autofocus")&&(t.populateDropdown.call(t),t.showDropdown.call(t))):t.$field.on("change."+t._name,function(e){t.loadOptionsFromSelect(),t.updateTrigger()})},unbindEvents:function(){this.$element.off("."+this._name),this.$dropdown.off("."+this._name),this.$dropdown.find(".search-input").off("."+this._name),this.$field.off("."+this._name),s("body").off("."+this._name)},onItemTap:function(e){var t,e=s(e.currentTarget),i=e.data("option");return this.multiple?(this.$dropdown.find(".selector.selected").removeClass("selected"),(e.is(".active")?(t="remove",e.removeClass("active"),e.find("input").prop("checked",!1)):(t="add",e.addClass("active selected"),e.find("input").prop("checked",!0))).trigger("change"),this.changeSelected(i,t)):(this.changeSelected(i,"add"),this.closeDropdown(!0))},onHiddenKeydown:function(e){if(!this.open&&9!==e.which){if(38===e.which||40===e.which)return this.showDropdown();var t;13!==e.which&&(39===e.which||37===e.which?e.preventDefault():-1===[9,13,27,37,38,39,40].indexOf(e.which)&&(e.preventDefault(),this.showDropdown(),t=e.which||e.keyCode,t=String.fromCharCode(t).toLowerCase(),this.$dropdown.find(".search-input").val(t),this.onSearchKeyup(e)))}},onSearchKeydown:function(e){var t,i;return 9===e.which?((t=this.$dropdown.find(".selector.selected")).length&&(i=t.data("option"),this.changeSelected(i,"add")),(i=(i=this.$element.closest("form").find(":input:visible").not(".ignore")).eq(i.index(e.target)+1)).length&&(i.focus(),e.preventDefault()),this.closeDropdown()):27===e.which?this.closeDropdown(!0):(13===e.which&&((t=this.$dropdown.find(".selector.selected")).length&&t.trigger("tap"),e.preventDefault()),40!==e.which&&39!==e.which||(this.highlightOption(this.$dropdown.find(".selector.selected").nextAll(".selector:visible").first()),e.preventDefault()),void(38!==e.which&&37!==e.which||(this.highlightOption(this.$dropdown.find(".selector.selected").prevAll(".selector:visible").first()),e.preventDefault())))},onSearchKeyup:function(e){var t,i;-1===[9,13,27,37,38,39,40].indexOf(e.which)&&((t=s(e.currentTarget).val().toLowerCase())?(i=this.$dropdown.find(".selector"),(i=this.multiple?i.filter(":not(.active)"):i).each(function(){0<=s(this).data("option").text.toLowerCase().indexOf(t)?s(this).removeClass("hide"):s(this).addClass("hide")})):this.$dropdown.find(".selector").removeClass("hide"),this.highlightOption(this.$dropdown.find(".selector:visible").first())),e.preventDefault()},highlightOption:function(e,t){!1!==t&&(t=!0),(e=e||this.$dropdownScroll.find(".selector.active:eq(0)")).length&&(this.$dropdown.find(".selector.selected").removeClass("selected"),e.addClass("selected"),t)&&this.highlightScrollTo(e)},highlightScrollTo:function(e){var t,i,n;(e=e||this.$dropdown.find(".selector.selected")).length&&(t=this.$dropdownScroll.scrollTop(),i=this.$dropdownScroll.outerHeight(),n=this.$dropdownScroll.offset().top,i+t<(n=t+e.offset().top-n)+(e=e.outerHeight())?this.$dropdownScroll.scrollTop(n+e-i):n<t&&this.$dropdownScroll.scrollTop(n))},populateDropdown:function(){for(var t=this,e=(this.$dropdownScroll.find("li").remove(),0===this.$dropdown.find(".search-input").length&&this.$dropdown.prepend('<div class="close">&times;</div>').prepend('<div class="search"><input type="text" class="ux-form-input-item simple search-input"></input></div>').find(".search-input").attr("placeholder",this.placeholder).on("keydown."+this._name,function(e){t.onSearchKeydown.call(t,e)}).on("keyup."+this._name,function(e){t.onSearchKeyup.call(t,e)}),this.$dropdown.find(".search-input").attr("placeholder","Search..."),this.getAllOptions()),i=0;i<e.length;i++){var n=e[i],o=s("<li></li>");n.group?(o.addClass("optgroup"),o.html("<span>"+n.text+"</span>")):this.multiple?(o.addClass("selector ux-form-checkbox ready"),o.html('<span><input type="checkbox" class="form-checkbox ignore" data-ux-auto-submit-exclude><label class="option">'+n.text+'<div class="ux-ripple"></div></label></span>')):(o.addClass("selector"),o.html("<span>"+n.text+"</span>")),n.selected&&(o.addClass("active"),o.find("input").prop("checked",!0)),o.data("option",n),this.$dropdownScroll.append(o)}this.multiple&&this.$dropdownScroll.find(".form-checkbox").on("change",function(){t.highlightOption(s(this).closest(".selector"),!1),t.$dropdown.find(".search-input").focus()}),this.highlightOption(),r.attachBehaviors(this.$dropdownScroll[0])},loadOptionsFromSelect:function(){var t=this;this.selected=[],this.$field.find("option, optgroup").each(function(){var e={value:"",text:"",selected:!1,group:!1};s(this).is("optgroup")?(e.text=s(this).attr("label"),e.group=!0):(e.value=s(this).attr("value"),e.text=s(this).html(),e.selected=s(this).is(":selected")),t.selected.push(e)})},getAllOptions:function(e){if(!e)return this.selected;for(var t=[],i=0;i<this.selected.length;i++)t.push(this.selected[i][e]);return t},updateTrigger:function(){var e=this.getSelectedOptions("value").join("");null===e||""===e||"_none"===e?(this.$trigger.val(""),this.$trigger.attr("placeholder",this.htmlDecode(this.getSelectedOptions("text").join(", ")))):this.$trigger.val(this.htmlDecode(this.getSelectedOptions("text").join(", "))).trigger("change")},updateSearch:function(){this.$dropdown.find(".search-input").attr("placeholder",this.getSelectedOptions("text").join(", "))},getSelectedOptions:function(e){for(var t=[],i=0;i<this.selected.length;i++)this.selected[i].selected&&t.push(e?this.selected[i][e]:this.selected[i]);return t},changeSelected:function(e,t){for(var i=!1,n=0;n<this.selected.length;n++)this.multiple||(this.selected[n].selected=!1),this.selected[n].value===e.value&&(i=!0,"add"===t?this.selected[n].selected=!0:"remove"===t&&(this.selected[n].selected=!1));this.updateTrigger(),this.multiple&&this.updateSearch(),this.updateSelect(i?null:e)},updateSelect:function(e){e&&(e=s("<option></option>").attr("value",e.value).html(e.text),this.$field.append(e)),this.$field.val(this.getSelectedOptions("value")),this.$field.trigger("change",[!0]),this.$field.trigger("input",[!0])},showDropdown:function(){var e=this;if(s("body").trigger("tap"),this.open)return this.closeDropdown();this.open=!0,this.$element.addClass("active"),this.highlightScrollTo(),setTimeout(function(){e.$element.addClass("animate"),e.$dropdown.find(".search-input").focus()},50),this.windowHideDropdown()},windowHideDropdown:function(){var t=this;s("body").on("tap."+t.uniqueId,function(e){!t.open||s(e.target).closest(t.$dropdown).length||t.closeDropdown()})},closeDropdown:function(e){var t=this;this.open=!1,this.$dropdown.find(".search-input").val(""),this.$dropdownScroll.find(".hide").removeClass("hide"),this.$element.removeClass("animate"),s("body").off("."+t.uniqueId),setTimeout(function(){!1===t.open&&t.$element.removeClass("active")},350),e&&setTimeout(function(){t.$hidden.trigger("focus",[1])})},isRequired:function(){return void 0!==this.$field.attr("required")},isDisabled:function(){return this.$field.is(":disabled")},isSupported:function(){return this.isIE()?8<=t.documentMode:!(/IEMobile/i.test(e.navigator.userAgent)||/Windows Phone/i.test(e.navigator.userAgent)||/BlackBerry/i.test(e.navigator.userAgent)||/BB10/i.test(e.navigator.userAgent))},isIE:function(){return e.navigator&&e.navigator.appName&&"Microsoft Internet Explorer"===e.navigator.appName},htmlDecode:function(e){return s("<div/>").html(e).text()}}),s.fn.uxFormSelect=function(t){return this.each(function(){var e=s(this);e.hasClass("browser-default")||e.find("select").hasClass("browser-default")||s.data(this,i)||s.data(this,i,new n(this,t))}),this},s.fn.uxFormSelect.defaults={debug:!1},r.behaviors.uxFormSelect={attach:function(e){s(e).find(".ux-form-select").once("ux-form-select").uxFormSelect()}}}(jQuery,Drupal,window,document);